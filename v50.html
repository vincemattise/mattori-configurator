<!-- MATTORI Frame³ Configurator v24 — Animated wizard transition -->
<script>
(function(){
  var sheets = [
    'https://cdn.jsdelivr.net/gh/vincemattise/mattori-configurator@v52/mattori-configurator.css'
  ];
  sheets.forEach(function(href){
    var l = document.createElement('link');
    l.rel = 'stylesheet';
    l.href = href;
    document.head.appendChild(l);
  });
})();
</script>

<div class="mattori-configurator" style="visibility:hidden;">

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- ADMIN PANEL                                 -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="admin-panel" id="adminPanel" style="display:none;">
    <div class="admin-panel-label">Admin &middot; v50</div>
    <div class="admin-panel-content">
      <div class="dropzone" id="dropzone">
        <div class="dropzone-icon"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg></div>
        <div class="dropzone-text">Sleep FML hierheen</div>
      </div>
      <input type="file" id="fileInput" accept=".fml,.json">
      <div class="admin-buttons" id="uploadActions">
        <button class="btn-admin" id="btnDownloadFml">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><polyline points="9 15 12 18 15 15"/></svg>
          FML
        </button>
        <button class="btn-admin" id="btnExport">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          OBJ
        </button>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;">
        <button class="btn-admin" id="btnTest1" onclick="pasteTestLink(1)">Test 1</button>
        <button class="btn-admin" id="btnTest2" onclick="pasteTestLink(2)">Test 2</button>
        <button class="btn-admin" id="btnTest3" onclick="pasteTestLink(3)">Test 3</button>
        <button class="btn-admin" id="btnTest4" onclick="pasteTestLink(4)">Test 4</button>
        <button class="btn-admin" id="btnTest5" onclick="pasteTestLink(5)">Test 5</button>
        <button class="btn-admin" id="btnTest6" onclick="pasteTestLink(6)">Test 6</button>
        <button class="btn-admin" id="btnTest7" onclick="pasteTestLink(7)">Test 7</button>
        <button class="btn-admin" id="btnTest8" onclick="pasteTestLink(8)">Test 8</button>
        <button class="btn-admin" id="btnTest9" onclick="pasteTestLink(9)">Test 9</button>
        <button class="btn-admin" id="btnTest10" onclick="pasteTestLink(10)">Test 10</button>
        <button class="btn-admin" id="btnTest11" onclick="pasteTestLink(11)">Test 11</button>
        <button class="btn-admin" id="btnTest12" onclick="pasteTestLink(12)">Test 12</button>
        <button class="btn-admin" id="btnTest13" onclick="pasteTestLink(13)">Test 13</button>
        <button class="btn-admin" id="btnTest14" onclick="pasteTestLink(14)">Test 14</button>
        <button class="btn-admin" id="btnTest15" onclick="pasteTestLink(15)">Test 15</button>
        <button class="btn-admin" id="btnTest16" onclick="pasteTestLink(16)">Test 16</button>
        <button class="btn-admin" id="btnTest17" onclick="pasteTestLink(17)">Test 17</button>
        <button class="btn-admin" id="btnTest18" onclick="pasteTestLink(18)">Test 18</button>
        <button class="btn-admin" id="btnTest19" onclick="pasteTestLink(19)">Test 19</button>
        <button class="btn-admin" id="btnTest20" onclick="pasteTestLink(20)">Test 20</button>
        <button class="btn-admin" id="btnTest21" onclick="pasteTestLink(21)">Test 21</button>
      </div>
      <label class="admin-checkbox" id="adminFrameToggle" style="display:none;">
        <input type="checkbox" id="adminUseAltFrame" onclick="toggleAdminFrame()" />
        Toon voorbeeld
      </label>
      <div class="file-label" id="fileLabel"></div>
      <div class="error-msg" id="errorMsg"></div>
      <div class="admin-floor-dims" id="adminFloorDims" style="display:none;"></div>
      <!-- Layout controls moved to step 4 per-floor cards -->
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- TWO-COLUMN LAYOUT                           -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="page-columns">

    <!-- LEFT COLUMN: Unified Frame Preview -->
    <div class="page-col-left">

      <!-- Initieel: productafbeelding (verborgen na Funda laden) -->
      <div class="product-hero-image stagger-in" id="productHeroImage" style="--stagger:0s">
        <div class="product-image-wrapper">
          <span class="product-example-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Z" /></svg>
            Afbeelding toont een voorbeeld
          </span>
          <img src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/One_2ef26725-1a92-4673-9c0b-3699a5be8e0a.png?v=1771605517" alt="MATTORI Frame³ – voorbeeld van een 3D ingelijste plattegrond">
        </div>
      </div>

      <!-- Unified frame preview (verschijnt na Funda laden) -->
      <div class="unified-frame-preview" id="unifiedFramePreview" style="display:none;">
        <div class="unified-frame-container">
          <img src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/Two_zonder_huisje_56d68527-71ff-4333-bfcf-6f2e6eca7d95.png?v=1771605516"
               class="unified-frame-image" id="unifiedFrameImage"
               alt="MATTORI Frame³" crossorigin="anonymous" />

          <!-- Address overlay (top zone) — hidden until step 2 -->
          <div class="unified-address-overlay" id="unifiedAddressOverlay" style="display:none;">
            <img class="frame-house-icon" id="frameHouseIcon"
                 src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/Huisje_1.png?v=1771603403"
                 alt="" crossorigin="anonymous" />
            <div class="unified-address-inner">
              <div class="frame-street" id="frameStreet"></div>
              <div class="frame-city" id="frameCity"></div>
            </div>
          </div>

          <!-- 3D floors overlay (middle zone) -->
          <div class="unified-floors-overlay" id="unifiedFloorsOverlay">
            <div class="floors-loading" id="floorsLoading">
              <div class="floors-loading-spinner"></div>
              <div class="floors-loading-text">Plattegronden laden...</div>
            </div>
            <div class="floors-grid" id="floorsGrid"></div>
          </div>

          <!-- Labels overlay (bottom zone) — hidden until step 5 -->
          <div class="unified-labels-overlay" id="unifiedLabelsOverlay" style="display:none;"></div>
        </div>
      </div>

      <!-- Floor review viewer (stap 4, in linkerkolom) -->
      <div class="floor-review-viewer" id="floorReviewViewer" style="display:none;"></div>

    </div>

    <!-- RIGHT COLUMN: Product info + Wizard -->
    <div class="page-col-right">
      <div class="page-col-right-inner">

        <h1 class="product-title collapsible-info stagger-in" style="--stagger:0.06s">Maak je eigen Mattori Frame&#179;</h1>

        <div class="product-price-block collapsible-info stagger-in" style="--stagger:0.12s">
          <span class="product-price-old">&euro;99,95</span>
          <span class="product-price-new">&euro;79,95</span>
          <span class="product-price-tax">incl. BTW</span>
        </div>

        <p class="product-description collapsible-info stagger-in" style="--stagger:0.18s">
          Na ontvangst van je bestelling starten wij direct met het zorgvuldig omzetten van jouw 2D Funda-plattegrond naar een 3D model. Elk model wordt door het team van MATTORI handmatig opgebouwd met focus op een realistische weergave.
        </p>

        <!-- Start configurator button -->
        <button class="btn-start-configurator stagger-in" id="btnStartConfigurator" style="--stagger:0.24s" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42" /></svg>
          Maak je eigen Frame&#179;
        </button>

        <!-- ═══════════════════════════════════════════ -->
        <!-- STEP WIZARD                                 -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="wizard" id="wizard" style="display:none;">

          <h2 class="wizard-title">Voer je Funda-link in</h2>

          <!-- Progress indicator -->
          <div class="wizard-progress" id="wizardProgress">
            <span class="wizard-step-indicator" id="wizardStepIndicator"></span>
            <div class="wizard-dots" id="wizardDots"></div>
          </div>

          <!-- Step 1: Funda URL -->
          <div class="wizard-step" id="wizardStep1" data-step="1">
            <p class="step-description">Plak de Funda-link van de woning.</p>
            <p class="step-hint" style="font-size:12px;color:#888;margin:-4px 0 8px 0;line-height:1.4;">De woning moet nog te koop staan op Funda. Bij verkochte woningen zijn de interactieve plattegronden niet meer beschikbaar.</p>
            <div class="url-input-group">
              <input type="url" id="fundaUrl" placeholder="https://www.funda.nl/..." />
              <button class="btn-export btn-funda" id="btnFunda" onclick="loadFromFunda()">Laden</button>
            </div>
            <div class="funda-status" id="fundaStatus">
              <div class="status-icon" id="fundaStatusIcon"></div>
              <div class="status-text" id="fundaStatusText"></div>
            </div>
          </div>

          <!-- Step 2: House icon + Address -->
          <div class="wizard-step" id="wizardStep2" data-step="2" style="display:none;">
            <div class="house-icon-picker" id="houseIconPicker">
              <p class="step-description">Kies een huisje.</p>
              <div class="house-icon-options" id="houseIconOptions"></div>
            </div>
            <p class="step-description" style="margin-top:24px;">Vul het adres in dat op de lijst komt te staan.</p>
            <div class="labels-fields">
              <div class="label-field-row">
                <span>Straat en huisnummer</span>
                <input type="text" id="addressStreet" placeholder="Kerkstraat 1" maxlength="30" />
              </div>
              <div class="label-field-row">
                <span>Plaats en land</span>
                <input type="text" id="addressCity" placeholder="Amsterdam, The Netherlands" maxlength="35" />
              </div>
            </div>
          </div>

          <!-- Step 3: Floor review — per-floor check -->
          <div class="wizard-step" id="wizardStep3" data-step="3" style="display:none;">
            <p class="step-description">Bekijk elke plattegrond en geef aan of deze klopt.</p>
            <div class="floor-review-controls">

              <!-- Counter + floor name -->
              <div class="floor-review-header">
                <span class="floor-review-counter" id="floorReviewCounter"></span>
                <span class="floor-review-name" id="floorReviewName"></span>
              </div>

              <!-- Default panel: confirm or flag -->
              <div class="floor-review-panel" id="floorReviewDefault">
                <div class="floor-review-actions-row">
                  <button type="button" class="btn-floor-flag" id="btnFloorFlag" onclick="showFloorIssuePanel()">Klopt niet</button>
                  <button type="button" class="btn-floor-good" id="btnFloorGood" onclick="confirmFloorGood()">Klopt <span class="check-icon"></span></button>
                </div>
                <p class="floor-review-hint-text">Wil je een plattegrond niet in je ontwerp? Dat stel je in bij de volgende stap.</p>
              </div>

              <!-- Issue panel: small difference -->
              <div class="floor-review-panel" id="floorReviewIssue" style="display:none;">
                <div class="floor-issue-box">
                  <textarea id="floorIssueText" class="wizard-input" placeholder="Beschrijf kort wat er anders is..." rows="2"></textarea>
                  <button type="button" class="btn-floor-save" onclick="saveFloorIssue()">Opslaan &amp; door</button>
                </div>
                <button type="button" class="btn-floor-major" onclick="showFloorMajorPanel()">Klopt helemaal niet</button>
              </div>

              <!-- Major panel: contact or trust -->
              <div class="floor-review-panel" id="floorReviewMajor" style="display:none;">
                <p class="floor-major-text">Geen zorgen - neem contact met ons op, of bestel op goed vertrouwen. We bekijken de plattegrond dan handmatig.</p>
                <div class="floor-major-actions">
                  <a class="btn-floor-contact" id="btnFloorContact" href="#">Contact</a>
                  <button type="button" class="btn-floor-trust" onclick="confirmFloorMajor()">Doorgaan</button>
                </div>
                <button type="button" class="btn-floor-back" onclick="showFloorDefaultPanel()">← Terug</button>
              </div>

              <!-- Thumbstrip -->
              <div class="floor-review-thumbstrip" id="floorReviewThumbstrip"></div>

            </div>
          </div>

          <!-- Step 4: Floor layout (grid-native) -->
          <div class="wizard-step" id="wizardStep4" data-step="4" style="display:none;">
            <p class="step-description">Kies welke verdiepingen je wilt meenemen.</p>

            <!-- Include/exclude checkboxes (rendered by JS) -->
            <div class="floor-include-bar" id="floorIncludeBar"></div>

            <!-- "Bereken indeling" button — triggers auto-placement -->
            <div style="text-align:center;margin-top:0.8rem;margin-bottom:0.8rem;">
              <button type="button" class="btn-wizard-next" id="btnCalcLayout">Bereken indeling &#8594;</button>
            </div>

            <!-- Post-calculation controls (hidden until calculated) -->
            <div id="layoutResultSection" style="display:none;">

              <!-- Layout tools box with edit checkbox at top -->
              <div class="layout-tools-box" id="layoutControlsBar">
                <div class="layout-tools-header">
                  <label class="layout-edit-toggle" id="lblToggleGrid">
                    <input type="checkbox" id="chkEditMode" />
                    <span>Handmatig aanpassen</span>
                    <span class="layout-reset-icon" id="btnResetLayout" title="Reset naar berekende posities" style="display:none;"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M3.5 2.5v3.5h3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3.5 6C4.3 4 6 2.5 8.2 2.5c3 0 5.3 2.4 5.3 5.5s-2.3 5.5-5.3 5.5c-2 0-3.8-1.2-4.6-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg></span>
                  </label>
                  <span class="info-tooltip info-tooltip-lg">i<span class="tooltip-content"><b>Schaal</b>: vergroot of verklein alle plattegronden.<br><br>Per plattegrond: uitlijning (links/midden/rechts, boven/midden/onder) en 90&deg; rotatie.<br><br>Sleep individuele plattegronden naar de gewenste positie op het grid.</span></span>
                </div>
                <div class="layout-controls-inner" id="layoutControlsInner">
                  <div class="layout-controls-bar">
                    <div class="layout-align-group">
                      <span class="layout-align-label">Schaal</span>
                      <div class="floor-align-group" id="scaleGroup"></div>
                    </div>
                  </div>
                  <div class="per-floor-section" id="perFloorAlignSection"></div>
                  <label class="layout-grid-toggle">
                    <input type="checkbox" id="chkShowGrid" checked />
                    <span>Toon grid</span>
                  </label>
                </div>
              </div>

              <div class="floor-layout-viewer" id="floorLayoutViewer"></div>
            </div>

            <!-- Note (visible after Bereken indeling) -->
            <div class="layout-note-section" style="display:none;">
              <textarea class="layout-note-input" id="layoutNote" rows="2" placeholder="Opmerking (optioneel): bijv. 'Voorgevels graag uitgelijnd'"></textarea>
            </div>
          </div>

          <!-- Step 5: Edit label texts -->
          <div class="wizard-step" id="wizardStep5" data-step="5" style="display:none;">
            <p class="step-description">Pas de verdiepingsnamen aan die onderin de lijst staan.</p>
            <div class="labels-fields" id="labelsFields"></div>
          </div>

          <!-- Navigation buttons -->
          <div class="wizard-nav" id="wizardNav">
            <button class="btn-wizard-prev" id="btnWizardPrev" style="display:none;">&#8592;</button>
            <button class="btn-wizard-next" id="btnWizardNext" style="display:none;">Volgende</button>
            <button class="btn-order" id="btnOrder" onclick="submitOrder()" style="display:none;">Afronden &amp; bestellen &#10022;</button>
            <div class="overlap-warning" id="overlapWarning" style="display:none;">Plattegronden overlappen elkaar. Verschuif ze zodat ze niet overlappen.</div>
          </div>

          <!-- Disclaimer (shown on last step) -->
          <div class="order-return-notice" id="orderNotice" style="display:none;">
            De preview is een indicatie - het eindresultaat kan in detail afwijken. Ons team bekijkt elke bestelling persoonlijk en zorgt ervoor dat jouw Frame&#179; er prachtig uitziet.
          </div>

        </div>

        <!-- Info badges -->
        <div class="product-badges collapsible-info stagger-in" style="--stagger:0.30s">
          <div class="product-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" /></svg>
            Gratis verzending met PostNL
          </div>
          <div class="product-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
            Vandaag besteld, binnen 5 werkdagen in huis
          </div>
          <div class="product-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" /></svg>
            Handgemaakt in Nederland
          </div>
        </div>

        <!-- Specificaties -->
        <div class="product-specs collapsible-info stagger-in" style="--stagger:0.36s">
          <div class="product-specs-title">Specificaties</div>
          <ul class="product-specs-list">
            <li><span class="spec-label">Materiaal lijst</span><span class="spec-value">Duurzaam kunststof</span></li>
            <li><span class="spec-label">Materiaal 3D plattegrond</span><span class="spec-value">Duurzaam kunststof</span></li>
            <li><span class="spec-label">Materiaal glas</span><span class="spec-value">Echt en verhard</span></li>
            <li><span class="spec-label">Materiaal papier</span><span class="spec-value">Premium textuur</span></li>
            <li><span class="spec-label">Afmeting</span><span class="spec-value">24 &times; 32,8 &times; 2,9 cm</span></li>
            <li><span class="spec-label">Gewicht</span><span class="spec-value">&plusmn; 750g</span></li>
          </ul>
        </div>

      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/polygon-clipping@0.15.7/dist/polygon-clipping.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/vincemattise/mattori-configurator@v52/mattori-configurator.js"></script>
