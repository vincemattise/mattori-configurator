<!-- MATTORI Frame³ Configurator v15 — Shopify Liquid -->
<link rel="preconnect" href="https://fonts.cdnfonts.com" crossorigin>
<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/nexa-bold">
<link rel="stylesheet" href="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/mattori-configurator.css" />

<div class="mattori-configurator has-mode-bar">
<!-- Admin/Klant mode toggle bar -->
  <div class="mode-toggle-bar" id="modeToggleBar">
    <span>Klant</span>
    <label class="mode-switch">
      <input type="checkbox" id="adminToggle" checked />
      <span class="slider"></span>
    </label>
    <span>Admin</span>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <div class="main-wrapper centered" id="mainWrapper">
    <!-- Left column: upload / tools -->
    <div class="upload-section" id="uploadSection">
      <div class="dropzone" id="dropzone">
        <div class="dropzone-icon">⬆</div>
        <div class="dropzone-text">Sleep je FML bestand hierheen</div>
      </div>

      <input type="file" id="fileInput" accept=".fml,.json">

      <div class="divider">of</div>

      <!-- Funda URL — shown in centered (initial) state, hidden in split -->
      <div id="fundaInitial">
        <div class="url-input-group">
          <input type="url" id="fundaUrlInitial" placeholder="Plak een Funda URL..." />
          <button class="btn-export btn-funda" id="btnFundaInitial">Laden</button>
        </div>
        <button class="btn-test" id="btnTestInitial">Test met voorbeeldwoning</button>

        <!-- Status checker (initial state) -->
        <div class="funda-status" id="fundaStatusInitial">
          <div class="status-icon" id="fundaStatusIconInitial"></div>
          <div class="status-text" id="fundaStatusTextInitial"></div>
        </div>
      </div>

      <div class="file-label" id="fileLabel"></div>
      <div class="error-msg" id="errorMsg"></div>

      <div class="upload-actions admin-only" id="uploadActions">
        <button class="btn-export" id="btnDownloadFml">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><polyline points="9 15 12 18 15 15"/></svg>
          Download FML
        </button>
        <button class="btn-export" id="btnExport">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Exporteer OBJ
        </button>
      </div>
    </div>

    <!-- Right column: order flow -->
    <div class="order-flow" id="orderFlow">

      <!-- Step 1: Funda URL (in right column, visible after split) -->
      <div class="order-step" id="stepFundaUrl">
        <div class="step-label">Funda link</div>
        <div class="url-input-group">
          <input type="url" id="fundaUrl" placeholder="Plak een Funda URL..." />
          <button class="btn-export btn-funda" id="btnFunda">Laden</button>
        </div>
        <button class="btn-test" id="btnTest">Test met voorbeeldwoning</button>

        <!-- Funda status checker -->
        <div class="funda-status" id="fundaStatus">
          <div class="status-icon" id="fundaStatusIcon"></div>
          <div class="status-text" id="fundaStatusText"></div>
        </div>
      </div>

      <!-- Step 2: Frame preview 1 — address on cropped top frame -->
      <div class="order-step">
        <div class="frame-preview" id="framePreview">
          <div class="step-label">Adres preview</div>
          <div class="preview-card">
            <div class="frame-container">
              <img src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/Frame_template_2.png?v=1771077134"
                   class="frame-image" alt="MATTORI Frame³ bovenkant" crossorigin="anonymous" />
              <div class="frame-overlay">
                <div class="frame-address" id="frameAddress">
                  <div class="frame-street" id="frameStreet"></div>
                  <div class="frame-city" id="frameCity"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Address edit checkbox -->
          <div class="address-edit-toggle">
            <input type="checkbox" id="addressEditToggle" />
            <label for="addressEditToggle">Ik wil het adres aanpassen</label>
          </div>

          <!-- Collapsible address fields -->
          <div class="address-fields" id="addressFields">
            <input type="text" id="addressStreet" placeholder="Straat + Huisnummer" />
            <input type="text" id="addressCity" placeholder="Stad, Land" />
          </div>
        </div>
      </div>

      <!-- Step 3: 3D floor viewers with frame middle section -->
      <div class="order-step" id="stepViewers" style="display:none;">
        <div class="step-label">Jouw plattegronden</div>
        <div class="preview-card">
          <div class="frame-middle-wrap">
            <img src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/Frame_template_4.png?v=1771087445"
                 class="frame-middle-bg" alt="" crossorigin="anonymous" />
            <div class="frame-middle-content">
              <div class="floors-grid" id="floorsGrid"></div>
            </div>
          </div>
        </div>

        <!-- Floor selection checkboxes -->
        <div class="floor-checkboxes" id="floorCheckboxes"></div>
      </div>

      <!-- Step 3b: Frame preview 3 — floor labels on cropped bottom frame -->
      <div class="order-step" id="stepLabelsPreview" style="display:none;">
        <div class="labels-preview" id="labelsPreview">
          <div class="step-label">Labels preview</div>
          <div class="preview-card">
            <div class="labels-container">
              <img src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/Frame_template_3.png?v=1771077135"
                   class="labels-image" alt="MATTORI Frame³ onderkant" crossorigin="anonymous" />
              <div class="labels-overlay" id="labelsOverlay">
                <!-- Labels worden dynamisch ingevuld -->
              </div>
            </div>
          </div>

          <!-- Labels edit checkbox -->
          <div class="labels-edit-toggle">
            <input type="checkbox" id="labelsEditToggle" />
            <label for="labelsEditToggle">Ik wil de labels aanpassen</label>
          </div>

          <!-- Collapsible label fields -->
          <div class="labels-fields" id="labelsFields">
            <!-- Dynamisch ingevuld -->
          </div>
        </div>
      </div>

      <!-- Step 4: Remarks -->
      <div class="order-step" id="stepRemarks" style="display:none;">
        <div class="step-label">Vragen of opmerkingen</div>
        <div class="remarks-field">
          <textarea id="remarksField" placeholder="Heb je speciale wensen of opmerkingen? Laat het hier weten..." rows="3"></textarea>
        </div>
      </div>

      <!-- Step 5: Order button -->
      <div class="order-step" id="stepOrder" style="display:none;">
        <button class="btn-order" id="btnOrder" disabled>Bestellen</button>
      </div>

      <!-- Step 6: Disclaimer -->
      <div class="order-step" id="stepDisclaimer" style="display:none;">
        <p class="disclaimer">Elk frame wordt met de hand samengesteld. De uiteindelijke compositie kan licht afwijken van de getoonde plattegronden.</p>
      </div>

    </div>
  </div>

  <div class="toast" id="toast"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.shopify.com/s/files/1/0958/8614/7958/files/mattori-configurator.js"></script>
